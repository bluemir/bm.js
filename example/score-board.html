<link rel="import" href="../minilib.html" />

<template>
	<style>
		:host {
		}
	</style>
	<slot name="header"></slot>
	<ol>
		<template name="item">
			<li id="{{name}}">{{name}} - {{score}}</li>
		</template>
	</ol>
</template>
<script>
	(function(template){
		class ScoreBoard extends CustomElement {
			constructor() {
				super(template.content);

				this.on("attribute-changed", (evt) => this.load(this.attr("from")));
			}
			static get observedAttributes() {
				return ["from"];
			}
			async load(url){
				if (!url) {
					console.warn("not enough information")
					return
				}
				var res = await $.request("GET", url)

				var t = $.get(this["--shadow"], "template[name=item]")
				$.all(this["--shadow"], "ol > li").forEach((e) => e.removeThis())
				res.json.map((e) => {
					return $.template(t, e);
					// or
					// return $.create("li", {$text: `${e.name} - ${e.score}`, id: e.name});
				}).forEach((e) => {
					$.get(this["--shadow"], "ol").appendChild(e);
				});
			}
		}
		customElements.define("score-board", ScoreBoard);
	})(document.currentScript.ownerDocument.querySelector('template'))
</script>
